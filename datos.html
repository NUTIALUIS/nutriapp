<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>📋 Evaluación Nutricional - Consultorio ObstNut</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    body {
      background: linear-gradient(135deg, #e8f5e9, #f1f8e9);
      min-height: 100vh;
      padding-top: 20px;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    .card {
      box-shadow: 0 8px 30px rgba(0,0,0,0.1);
      border: 0;
      border-radius: 16px;
      overflow: hidden;
    }
    .card-header {
      background: linear-gradient(90deg, #4caf50, #8bc34a);
      color: white;
      font-weight: 600;
      padding: 25px;
      text-align: center;
    }
    .form-label {
      font-weight: 500;
      color: #2e4053;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .form-label i {
      color: #4caf50;
    }
    .btn-primary {
      background: #4caf50;
      border: none;
      padding: 14px 32px;
      font-weight: 600;
      border-radius: 12px;
      font-size: 1.1rem;
      transition: all 0.3s ease;
    }
    .btn-primary:hover {
      background: #388e3c;
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
    }
    .resultado-card {
      background: white;
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.08);
      margin-top: 30px;
      display: none;
      animation: fadeIn 0.5s ease;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .badge-imc {
      font-size: 1.1rem;
      padding: 8px 20px;
      border-radius: 50px;
      font-weight: 600;
    }
    .imc-bajo { background: #2196f3; color: white; }
    .imc-normal { background: #4caf50; color: white; }
    .imc-sobrepeso { background: #ff9800; color: white; }
    .imc-obesidad { background: #f44336; color: white; }

    .info-box {
      background: #f9f9f9;
      border-left: 4px solid #4caf50;
      padding: 15px;
      border-radius: 0 8px 8px 0;
      margin: 15px 0;
    }
    .btn-imprimir {
      background: #2196f3;
      border: none;
      color: white;
      padding: 10px 24px;
      border-radius: 10px;
      font-weight: 600;
      font-size: 1rem;
      transition: all 0.3s;
    }
    .btn-imprimir:hover {
      background: #1976d2;
      transform: translateY(-2px);
    }
    .trimestre-section {
      background: #fff8e1;
      padding: 20px;
      border-radius: 12px;
      border: 2px dashed #ffc107;
      margin: 20px 0;
      display: none;
    }
    footer {
      margin-top: 40px;
      text-align: center;
      color: #666;
      font-size: 0.9rem;
      padding: 20px;
    }
    .alert-custom {
      border-radius: 12px;
      font-weight: 500;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-9">
        <div class="card">
          <div class="card-header">
            <h1 class="mb-2">📋 Evaluación Nutricional Integral</h1>
            <p class="mb-0 opacity-75">Datos antropométricos y cálculo de necesidades energéticas</p>
          </div>
          <div class="card-body p-4">

            <div class="alert alert-info alert-custom" role="alert">
              <i class="fas fa-info-circle"></i> <strong>Completa todos los campos</strong> para obtener una evaluación personalizada.
            </div>

            <form id="datos-form">
              <div class="row g-3">
                <div class="col-md-12">
                  <label for="nombre" class="form-label">
                    <i class="fas fa-user"></i> Nombre completo
                  </label>
                  <input type="text" id="nombre" class="form-control form-control-lg" required placeholder="Ej: María López" />
                </div>

                <div class="col-md-6">
                  <label for="edad" class="form-label">
                    <i class="fas fa-birthday-cake"></i> Edad (años)
                  </label>
                  <input type="number" id="edad" class="form-control" min="1" max="120" required placeholder="Ej: 28" />
                </div>

                <div class="col-md-6">
                  <label for="sexo" class="form-label">
                    <i class="fas fa-venus-mars"></i> Sexo
                  </label>
                  <select id="sexo" class="form-select form-select-lg" required>
                    <option value="">Seleccione una opción</option>
                    <option value="hombre">Hombre</option>
                    <option value="mujer">Mujer</option>
                    <option value="embarazada">Embarazada</option>
                  </select>
                </div>

                <div class="col-md-6">
                  <label for="peso" class="form-label">
                    <i class="fas fa-weight-hanging"></i> Peso (kg)
                  </label>
                  <input type="number" id="peso" class="form-control" min="1" max="300" step="0.1" required placeholder="Ej: 65.5" />
                </div>

                <div class="col-md-6">
                  <label for="talla" class="form-label">
                    <i class="fas fa-ruler-vertical"></i> Talla (cm)
                  </label>
                  <input type="number" id="talla" class="form-control" min="30" max="250" step="0.1" required placeholder="Ej: 165" />
                </div>

                <div class="col-md-6">
                  <label for="cintura" class="form-label">
                    <i class="fas fa-tape"></i> Circunferencia de cintura (cm)
                  </label>
                  <input type="number" id="cintura" class="form-control" min="30" max="200" step="0.1" required placeholder="Ej: 82" />
                </div>

                <div class="col-md-6">
                  <label for="cadera" class="form-label">
                    <i class="fas fa-hippo"></i> Circunferencia de cadera (cm)
                  </label>
                  <input type="number" id="cadera" class="form-control" min="30" max="200" step="0.1" required placeholder="Ej: 98" />
                </div>

                <div class="col-md-12">
                  <label for="actividad" class="form-label">
                    <i class="fas fa-running"></i> Nivel de actividad física
                  </label>
                  <select id="actividad" class="form-select form-select-lg" required>
                    <option value="">Seleccione su nivel de actividad</option>
                    <option value="1.2">Sedentario (poco o ningún ejercicio)</option>
                    <option value="1.375">Ligero (ejercicio 1-3 días/semana)</option>
                    <option value="1.55">Moderado (ejercicio 3-5 días/semana)</option>
                    <option value="1.725">Intenso (ejercicio 6-7 días/semana)</option>
                    <option value="1.9">Muy intenso (trabajo físico o doble entrenamiento)</option>
                  </select>
                </div>

                <!-- Sección de trimestre (solo para embarazadas) -->
                <div class="col-12" id="trimestreDiv" style="display:none;">
                  <div class="trimestre-section">
                    <h5><i class="fas fa-baby"></i> Información de embarazo</h5>
                    <label for="trimestre" class="form-label">Trimestre de embarazo</label>
                    <select id="trimestre" class="form-select form-select-lg">
                      <option value="1">1er Trimestre</option>
                      <option value="2">2do Trimestre</option>
                      <option value="3">3er Trimestre</option>
                    </select>
                  </div>
                </div>

                <div class="col-12">
                  <label for="antecedentes" class="form-label">
                    <i class="fas fa-notes-medical"></i> Antecedentes médicos (opcional)
                  </label>
                  <textarea id="antecedentes" class="form-control" rows="3" placeholder="Diabetes, hipertensión, alergias, etc."></textarea>
                </div>
              </div>

              <div class="text-center mt-4">
                <button type="submit" class="btn btn-primary btn-lg">
                  <i class="fas fa-calculator"></i> Calcular Evaluación Nutricional
                </button>
              </div>
            </form>

            <!-- Resultado -->
            <div id="resultado" class="resultado-card">
              <div class="text-center mb-4">
                <h2 class="mb-3">📊 Resultados de la Evaluación</h2>
                <div id="imc-badge" class="badge-imc"></div>
              </div>

              <div class="row">
                <div class="col-md-6">
                  <div class="info-box">
                    <h5><i class="fas fa-weight"></i> Índice de Masa Corporal (IMC)</h5>
                    <p id="imc-valor" class="fs-4 fw-bold mb-0"></p>
                    <p id="imc-categoria" class="text-muted mb-0"></p>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="info-box">
                    <h5><i class="fas fa-heartbeat"></i> Riesgo Cardiovascular (ICC)</h5>
                    <p id="icc-valor" class="fs-4 fw-bold mb-0"></p>
                    <p id="icc-riesgo" class="text-muted mb-0"></p>
                  </div>
                </div>
              </div>

              <div class="info-box mt-4">
                <h5><i class="fas fa-fire"></i> Necesidades Energéticas</h5>
                <div id="energia-resultados"></div>
              </div>

              <div id="recomendaciones-section" class="info-box mt-4">
                <h5><i class="fas fa-lightbulb"></i> Recomendaciones Personalizadas</h5>
                <div id="recomendaciones"></div>
              </div>

              <div class="text-center mt-4">
                <button onclick="window.print()" class="btn btn-imprimir">
                  <i class="fas fa-print"></i> Imprimir Resultado
                </button>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>

    <footer>
      <p><i class="fas fa-heart" style="color:#4caf50;"></i> © 2025 Consultorio ObstNut — Atención nutricional gratuita y personalizada</p>
    </footer>
  </div>

  <script>
    // Mostrar/ocultar trimestre según sexo
    document.getElementById("sexo").addEventListener("change", function () {
      const sexo = this.value;
      const trimestreDiv = document.getElementById("trimestreDiv");
      if (sexo === "embarazada") {
        trimestreDiv.style.display = "block";
      } else {
        trimestreDiv.style.display = "none";
      }
    });

    // Clasificar IMC
    function clasificarIMC(imc) {
      if (imc < 18.5) return { categoria: "Bajo peso", clase: "imc-bajo" };
      else if (imc < 25) return { categoria: "Normopeso", clase: "imc-normal" };
      else if (imc < 30) return { categoria: "Sobrepeso", clase: "imc-sobrepeso" };
      else if (imc < 35) return { categoria: "Obesidad grado 1", clase: "imc-obesidad" };
      else if (imc < 40) return { categoria: "Obesidad grado 2", clase: "imc-obesidad" };
      else return { categoria: "Obesidad grado 3", clase: "imc-obesidad" };
    }

    // Evaluar riesgo cardiovascular
    function riesgoCardiovascularICC(icc, sexo) {
      if (sexo === "hombre") {
        return icc < 0.90 ? "Riesgo bajo" : "Riesgo aumentado";
      } else {
        return icc < 0.85 ? "Riesgo bajo" : "Riesgo aumentado";
      }
    }

    // Generar recomendaciones personalizadas
    function generarRecomendaciones(imc, sexo, trimestre, actividad) {
      let recomendaciones = [];

      if (imc < 18.5) {
        recomendaciones.push("✅ Aumentar ingesta calórica con alimentos densos nutricionalmente.");
        recomendaciones.push("✅ Incluir snacks saludables entre comidas.");
        recomendaciones.push("✅ Asegurar ingesta adecuada de proteínas.");
      } else if (imc >= 25 && imc < 30) {
        recomendaciones.push("✅ Moderar porciones y frecuencia de alimentos altos en calorías.");
        recomendaciones.push("✅ Aumentar consumo de vegetales y fibra.");
        recomendaciones.push("✅ Mantener actividad física regular.");
      } else if (imc >= 30) {
        recomendaciones.push("✅ Plan nutricional supervisado para pérdida de peso gradual.");
        recomendaciones.push("✅ Reducir alimentos ultraprocesados y azúcares añadidos.");
        recomendaciones.push("✅ Priorizar proteínas magras y fibra soluble.");
      } else {
        recomendaciones.push("✅ Mantener hábitos saludables y actividad física regular.");
        recomendaciones.push("✅ Monitorear peso mensualmente.");
      }

      if (sexo === "embarazada") {
        if (trimestre === "1") {
          recomendaciones.push("🤰 1er trimestre: Enfocarse en ácido fólico, hierro y manejo de náuseas.");
        } else if (trimestre === "2") {
          recomendaciones.push("🤰 2do trimestre: Aumentar proteínas, calcio y energía según necesidad.");
        } else {
          recomendaciones.push("🤰 3er trimestre: Asegurar hierro, omega-3 y fibra para evitar estreñimiento.");
        }
      }

      if (actividad < 1.375) {
        recomendaciones.push("🏃‍♀️ Incrementar actividad física gradualmente para mejorar metabolismo.");
      }

      return recomendaciones.map(r => `<p><i class="fas fa-check-circle text-success"></i> ${r}</p>`).join('');
    }

    // Manejar envío del formulario
    document.getElementById("datos-form").addEventListener("submit", function (e) {
      e.preventDefault();

      const nombre = document.getElementById("nombre").value.trim();
      const edad = parseInt(document.getElementById("edad").value);
      const sexo = document.getElementById("sexo").value;
      const peso = parseFloat(document.getElementById("peso").value);
      const tallaCm = parseFloat(document.getElementById("talla").value);
      const cintura = parseFloat(document.getElementById("cintura").value);
      const cadera = parseFloat(document.getElementById("cadera").value);
      const actividad = parseFloat(document.getElementById("actividad").value);
      const antecedentes = document.getElementById("antecedentes").value.trim();
      const trimestre = document.getElementById("trimestre")?.value || "1";

      // Validación
      if (!nombre || isNaN(edad) || !sexo || isNaN(peso) || isNaN(tallaCm) || isNaN(cintura) || isNaN(cadera) || isNaN(actividad)) {
        alert("⚠️ Por favor completa todos los campos obligatorios.");
        return;
      }

      if (cadera === 0) {
        alert("⚠️ La circunferencia de cadera no puede ser cero.");
        return;
      }

      // Cálculos
      const tallaM = tallaCm / 100;
      const imc = peso / (tallaM * tallaM);
      const { categoria: categoriaIMC, clase: claseIMC } = clasificarIMC(imc);
      const icc = cintura / cadera;
      const riesgoICC = riesgoCardiovascularICC(icc, sexo);

      // Peso ideal
      let pesoIdeal = NaN;
      if (sexo === "hombre") {
        pesoIdeal = 50 + 0.9 * (tallaCm - 152);
      } else if (sexo === "mujer") {
        pesoIdeal = 45.5 + 0.9 * (tallaCm - 152);
      }

      // TMB y GET
      let tmb = 0;
      if (sexo === "hombre") {
        tmb = 66.5 + 13.75 * peso + 5.003 * tallaCm - 6.75 * edad;
      } else {
        tmb = 655 + 9.563 * peso + 1.850 * tallaCm - 4.676 * edad;
        if (sexo === "embarazada") {
          if (trimestre === "1") tmb += 85;
          else if (trimestre === "2") tmb += 285;
          else if (trimestre === "3") tmb += 475;
        }
      }

      const get = tmb * actividad;
      let tmbPesoIdeal = NaN, getPesoIdeal = NaN;
      if (!isNaN(pesoIdeal)) {
        if (sexo === "hombre") {
          tmbPesoIdeal = 66.5 + 13.75 * pesoIdeal + 5.003 * tallaCm - 6.75 * edad;
        } else if (sexo === "mujer") {
          tmbPesoIdeal = 655 + 9.563 * pesoIdeal + 1.850 * tallaCm - 4.676 * edad;
        }
        getPesoIdeal = tmbPesoIdeal * actividad;
      }

      // Mostrar resultados
      document.getElementById("imc-valor").textContent = `${imc.toFixed(2)} kg/m²`;
      document.getElementById("imc-categoria").textContent = categoriaIMC;
      const badge = document.getElementById("imc-badge");
      badge.textContent = categoriaIMC;
      badge.className = `badge-imc ${claseIMC}`;

      document.getElementById("icc-valor").textContent = icc.toFixed(2);
      document.getElementById("icc-riesgo").textContent = riesgoICC;

      // Mostrar energía
      let energiaHTML = `
        <p><strong>TMB (peso actual):</strong> ${tmb.toFixed(2)} kcal/día</p>
        <p><strong>GET (peso actual):</strong> ${get.toFixed(2)} kcal/día</p>
      `;
      if (!isNaN(getPesoIdeal)) {
        energiaHTML += `
          <p><strong>TMB (peso ideal):</strong> ${tmbPesoIdeal.toFixed(2)} kcal/día</p>
          <p><strong>GET (peso ideal):</strong> ${getPesoIdeal.toFixed(2)} kcal/día</p>
        `;
      }
      document.getElementById("energia-resultados").innerHTML = energiaHTML;

      // Mostrar recomendaciones
      const recomendacionesHTML = generarRecomendaciones(imc, sexo, trimestre, actividad);
      document.getElementById("recomendaciones").innerHTML = recomendacionesHTML;

      // Mostrar antecedentes si existen
      if (antecedentes) {
        document.getElementById("recomendaciones").innerHTML += `
          <div class="mt-3 pt-3 border-top">
            <h6><i class="fas fa-notes-medical"></i> Antecedentes médicos:</h6>
            <p>${antecedentes}</p>
          </div>
        `;
      }

      // Mostrar resultado con animación
      const resultadoDiv = document.getElementById("resultado");
      resultadoDiv.style.display = "block";
      resultadoDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
    });
  </script>
</body>
</html>
